<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>angular-oauth2-oidc</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	    <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">angular-oauth2-oidc</a>
            <button type="button" class="btn btn-default btn-menu fa fa-bars" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <div id="book-search-input" role="search">
                <input type="text" placeholder="Type to search">
            </div>
            <nav>
            
                <ul class="list">
            
                    <li class="title">
                        <a href="../index.html">angular-oauth2-oidc</a>
                    </li>
            
                    <li class="divider"></li>
            
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../index.html"><span class="fa fa-home"></span>Getting started</a>
                        <ul class="links">
                                <li class="link">
                                    <a 
                                        
                                         href="../overview.html" 
                                         href="../overview.html" 
                                        >
                                        <span class="fa fa-th"></span>Overview
                                    </a>
                                </li>
                                <li class="link">
                                  <a href="../index.html" ><span class="fa fa-file-text-o"></span>README</a>
                                </li>
                                <li class="link">
                                    <a href="./license.html"
                                        >
                                        <span class="fa fa-file-text-o"></span>LICENSE
                                    </a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <div class="simple menu-toggler" data-toggle="collapse"
                                data-target="#xs-additional-pages"
                            >
                            <span class="fa fa-book"></span>
                            <span>Additional documentation</span>
                            <span class="fa fa-angle-down"></span>
                        </div>
                        <ul class="links collapse "
                                id="xs-additional-pages"
                            >
                                <li class="link ">
                                    <a href="../additional-documentation/getting-started.html" >Getting Started</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/preserving-state-(like-the-requested-url).html" >Preserving State (like the Requested URL)</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/refreshing-a-token-(silent-refresh).html" >Refreshing a Token (Silent Refresh)</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/callback-after-login.html" >Callback after login</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/custom-query-parameters.html" >Custom Query Parameters</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/events.html" >Events</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/routing-with-the-hashstrategy.html" >Routing with the HashStrategy</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/configure/-adapt-id_token-validation.html" >Configure/ Adapt id_token Validation</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/session-checks.html" >Session Checks</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/configure-library-for-implicit-flow-without-discovery-document.html" >Configure Library for Implicit Flow without discovery document</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/using-systemjs.html" >Using SystemJS</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/original-config-api.html" >Original Config API</a>
                                </li>
                                <li class="link ">
                                    <a href="../additional-documentation/using-password-flow.html" >Using Password Flow</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../modules.html" >
                            <div class="menu-toggler linked" data-toggle="collapse"
                                    data-target="#xs-modules-links"
                            >
                                <span class="fa fa-archive"></span>
                                <span class="link-name">Modules</span>
                                <span class="fa fa-angle-down"></span>
                            </div>
                        </a>
                        <ul class="links collapse "
                                id="xs-modules-links"
                            >
                                <li class="link">
                                    <a href="../modules/OAuthModule.html" >OAuthModule</a>
                                </li>
                        </ul>
                    </li>
            
            
            
                    <li class="chapter">
                        <div class="simple menu-toggler" data-toggle="collapse"
                                data-target="#xs-classes-links"
                            >
                            <span class="fa fa-file-code-o"></span>
                            <span>Classes</span>
                            <span class="fa fa-angle-down"></span>
                        </div>
                        <ul class="links collapse "
                                id="xs-classes-links"
                            >
                                <li class="link">
                                    <a href="../classes/AbstractValidationHandler.html" >AbstractValidationHandler</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/AuthConfig.html" >AuthConfig</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/JwksValidationHandler.html" >JwksValidationHandler</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/LoginOptions.html" >LoginOptions</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/NullValidationHandler.html" >NullValidationHandler</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/OAuthErrorEvent.html" >OAuthErrorEvent</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/OAuthEvent.html" >OAuthEvent</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/OAuthInfoEvent.html" >OAuthInfoEvent</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/OAuthStorage.html" >OAuthStorage</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/OAuthSuccessEvent.html" >OAuthSuccessEvent</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/ReceivedTokens.html" >ReceivedTokens</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/ValidationHandler.html" >ValidationHandler</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <div class="simple menu-toggler" data-toggle="collapse"
                                data-target="#xs-injectables-links"
                            >
                            <span class="fa fa-long-arrow-down"></span>
                            <span>Injectables</span>
                            <span class="fa fa-angle-down"></span>
                        </div>
                        <ul class="links collapse "
                                id="xs-injectables-links"
                            >
                                <li class="link">
                                    <a href="../injectables/OAuthService.html"  data-type="entity-link" class="active" >OAuthService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/UrlHelperService.html" >UrlHelperService</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <div class="simple menu-toggler" data-toggle="collapse"
                                data-target="#xs-interfaces-links"
                            >
                            <span class="fa fa-info"></span>
                            <span>Interfaces</span>
                            <span class="fa fa-angle-down"></span>
                        </div>
                        <ul class="links collapse "
                                id="xs-interfaces-links"
                            >
                                <li class="link">
                                    <a href="../interfaces/ParsedIdToken.html" >ParsedIdToken</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/ValidationParams.html" >ValidationParams</a>
                                </li>
                        </ul>
                    </li>
            
            
                    <li class="chapter">
                        <div class="simple menu-toggler" data-toggle="collapse"
                                data-target="#xs-miscellaneous-links"
                            >
                            <span class="fa fa-cubes"></span>
                            <span>Miscellaneous</span>
                            <span class="fa fa-angle-down"></span>
                        </div>
                        <ul class="links collapse "
                                id="xs-miscellaneous-links"
                            >
                                <li class="link">
                                  <a href="../miscellaneous/functions.html" data-type="entity-link" >Functions</a>
                                </li>
                                <li class="link">
                                  <a href="../miscellaneous/typealiases.html" data-type="entity-link" >Type aliases</a>
                                </li>
                                <li class="link">
                                  <a href="../miscellaneous/variables.html" data-type="entity-link" >Variables</a>
                                </li>
                        </ul>
                    </li>
            
            
            
            
                </ul>
            
            </nav>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <nav>
                   
                       <ul class="list">
                   
                           <li class="title">
                               <a href="../index.html">angular-oauth2-oidc</a>
                           </li>
                   
                           <li class="divider"></li>
                   
                               <div id="book-search-input" role="search">
                                   <input type="text" placeholder="Type to search">
                               </div>
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../index.html"><span class="fa fa-home"></span>Getting started</a>
                               <ul class="links">
                                       <li class="link">
                                           <a 
                                               
                                                href="../overview.html" 
                                                href="../overview.html" 
                                               >
                                               <span class="fa fa-th"></span>Overview
                                           </a>
                                       </li>
                                       <li class="link">
                                         <a href="../index.html" ><span class="fa fa-file-text-o"></span>README</a>
                                       </li>
                                       <li class="link">
                                           <a href="./license.html"
                                               >
                                               <span class="fa fa-file-text-o"></span>LICENSE
                                           </a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple menu-toggler" data-toggle="collapse"
                                       data-target="#additional-pages"
                   >
                                   <span class="fa fa-book"></span>
                                   <span>Additional documentation</span>
                                   <span class="fa fa-angle-down"></span>
                               </div>
                               <ul class="links collapse "
                                       id="additional-pages"
                   >
                                       <li class="link ">
                                           <a href="../additional-documentation/getting-started.html" >Getting Started</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/preserving-state-(like-the-requested-url).html" >Preserving State (like the Requested URL)</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/refreshing-a-token-(silent-refresh).html" >Refreshing a Token (Silent Refresh)</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/callback-after-login.html" >Callback after login</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/custom-query-parameters.html" >Custom Query Parameters</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/events.html" >Events</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/routing-with-the-hashstrategy.html" >Routing with the HashStrategy</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/configure/-adapt-id_token-validation.html" >Configure/ Adapt id_token Validation</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/session-checks.html" >Session Checks</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/configure-library-for-implicit-flow-without-discovery-document.html" >Configure Library for Implicit Flow without discovery document</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/using-systemjs.html" >Using SystemJS</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/original-config-api.html" >Original Config API</a>
                                       </li>
                                       <li class="link ">
                                           <a href="../additional-documentation/using-password-flow.html" >Using Password Flow</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../modules.html" >
                                   <div class="menu-toggler linked" data-toggle="collapse"
                                           data-target="#modules-links"
                                   >
                                       <span class="fa fa-archive"></span>
                                       <span class="link-name">Modules</span>
                                       <span class="fa fa-angle-down"></span>
                                   </div>
                               </a>
                               <ul class="links collapse "
                                       id="modules-links"
                   >
                                       <li class="link">
                                           <a href="../modules/OAuthModule.html" >OAuthModule</a>
                                       </li>
                               </ul>
                           </li>
                   
                   
                   
                           <li class="chapter">
                               <div class="simple menu-toggler" data-toggle="collapse"
                                       data-target="#classes-links"
                   >
                                   <span class="fa fa-file-code-o"></span>
                                   <span>Classes</span>
                                   <span class="fa fa-angle-down"></span>
                               </div>
                               <ul class="links collapse "
                                       id="classes-links"
                   >
                                       <li class="link">
                                           <a href="../classes/AbstractValidationHandler.html" >AbstractValidationHandler</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/AuthConfig.html" >AuthConfig</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/JwksValidationHandler.html" >JwksValidationHandler</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/LoginOptions.html" >LoginOptions</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/NullValidationHandler.html" >NullValidationHandler</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/OAuthErrorEvent.html" >OAuthErrorEvent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/OAuthEvent.html" >OAuthEvent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/OAuthInfoEvent.html" >OAuthInfoEvent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/OAuthStorage.html" >OAuthStorage</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/OAuthSuccessEvent.html" >OAuthSuccessEvent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/ReceivedTokens.html" >ReceivedTokens</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/ValidationHandler.html" >ValidationHandler</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple menu-toggler" data-toggle="collapse"
                                       data-target="#injectables-links"
                   >
                                   <span class="fa fa-long-arrow-down"></span>
                                   <span>Injectables</span>
                                   <span class="fa fa-angle-down"></span>
                               </div>
                               <ul class="links collapse "
                                       id="injectables-links"
                   >
                                       <li class="link">
                                           <a href="../injectables/OAuthService.html"  data-type="entity-link" class="active" >OAuthService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/UrlHelperService.html" >UrlHelperService</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple menu-toggler" data-toggle="collapse"
                                       data-target="#interfaces-links"
                   >
                                   <span class="fa fa-info"></span>
                                   <span>Interfaces</span>
                                   <span class="fa fa-angle-down"></span>
                               </div>
                               <ul class="links collapse "
                                       id="interfaces-links"
                   >
                                       <li class="link">
                                           <a href="../interfaces/ParsedIdToken.html" >ParsedIdToken</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/ValidationParams.html" >ValidationParams</a>
                                       </li>
                               </ul>
                           </li>
                   
                   
                           <li class="chapter">
                               <div class="simple menu-toggler" data-toggle="collapse"
                                       data-target="#miscellaneous-links"
                   >
                                   <span class="fa fa-cubes"></span>
                                   <span>Miscellaneous</span>
                                   <span class="fa fa-angle-down"></span>
                               </div>
                               <ul class="links collapse "
                                       id="miscellaneous-links"
                   >
                                       <li class="link">
                                         <a href="../miscellaneous/functions.html" data-type="entity-link" >Functions</a>
                                       </li>
                                       <li class="link">
                                         <a href="../miscellaneous/typealiases.html" data-type="entity-link" >Type aliases</a>
                                       </li>
                                       <li class="link">
                                         <a href="../miscellaneous/variables.html" data-type="entity-link" >Variables</a>
                                       </li>
                               </ul>
                           </li>
                   
                   
                   
                   
                       </ul>
                   
                   </nav>
               </div>
               <div class="content injectable">
                   <div class="content-data">






<ol class="breadcrumb">
  <li>Injectables</li>
  <li>OAuthService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
    <li class="active">
        <a href="#info" id="info-tab" role="tab" data-toggle="tab" data-link="info">Info</a>
    </li>


    <li>
        <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
    </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/oauth-service.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Service for logging in and logging out with
OIDC and OAuth2. Supports implicit flow and
password flow.</p>

            </p>


            <section>
                <h3 id="index">Index</h3>
                <table class="table table-sm table-bordered index-table">
                    <tbody>
                        <tr>
                            <td class="col-md-4">
                                <h6><b>Properties</b></h6>
                            </td>
                        </tr>
                        <tr>
                            <td class="col-md-4">
                                <ul class="index-list">
                                    <li>
                                        <span class="modifier">Public</span> <a href="#events">events</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#state">state</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#tokenValidationHandler">tokenValidationHandler</a>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td class="col-md-4">
                                <h6><b>Methods</b></h6>
                            </td>
                        </tr>
                        <tr>
                            <td class="col-md-4">
                                <ul class="index-list">
                                    <li>
                                        <span class="modifier">Public</span> <a href="#authorizationHeader">authorizationHeader</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#configure">configure</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#createAndSaveNonce">createAndSaveNonce</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Protected</span> <a href="#createNonce">createNonce</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#fetchTokenUsingPasswordFlow">fetchTokenUsingPasswordFlow</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#fetchTokenUsingPasswordFlowAndLoadUserProfile">fetchTokenUsingPasswordFlowAndLoadUserProfile</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#getAccessToken">getAccessToken</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#getAccessTokenExpiration">getAccessTokenExpiration</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#getIdentityClaims">getIdentityClaims</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#getIdToken">getIdToken</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#getIdTokenExpiration">getIdTokenExpiration</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Protected</span> <a href="#getSessionState">getSessionState</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#hasValidAccessToken">hasValidAccessToken</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#hasValidIdToken">hasValidIdToken</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#initImplicitFlow">initImplicitFlow</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#loadDiscoveryDocument">loadDiscoveryDocument</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#loadDiscoveryDocumentAndTryLogin">loadDiscoveryDocumentAndTryLogin</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#loadUserProfile">loadUserProfile</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#logOut">logOut</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#processIdToken">processIdToken</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#refreshToken">refreshToken</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#restartSessionChecksIfStillLoggedIn">restartSessionChecksIfStillLoggedIn</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#setStorage">setStorage</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#setupAutomaticSilentRefresh">setupAutomaticSilentRefresh</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#silentRefresh">silentRefresh</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Protected</span> <a href="#storeIdToken">storeIdToken</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Protected</span> <a href="#storeSessionState">storeSessionState</a>
                                    </li>
                                    <li>
                                        <span class="modifier">Public</span> <a href="#tryLogin">tryLogin</a>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <h3 id="constructor">Constructor</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <code>constructor(http: <a href="https://angular.io/docs/ts/latest/api/http/index/Http-class.html" target="_blank">Http</a>, storage: <a href="../classes/OAuthStorage.html">OAuthStorage</a>, tokenValidationHandler: <a href="../classes/ValidationHandler.html">ValidationHandler</a>, config: <a href="../classes/AuthConfig.html">AuthConfig</a>, urlHelper: <a href="../injectables/UrlHelperService.html">UrlHelperService</a>)</code>
                                </td>
                            </tr>
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="65" class="link-to-prism">src/oauth-service.ts:65</a></div>
                                        </td>
                                    </tr>
            
                        </tbody>
                    </table>
            </section>

            <section>
                
                    <h3 id="methods">
                        Methods
                    </h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="authorizationHeader"></a>
                                    <b><span class="modifier">Public</span> authorizationHeader</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>authorizationHeader()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1376" class="link-to-prism">src/oauth-service.ts:1376</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Returns the auth-header that can be used
            to transmit the access_token to a service</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="configure"></a>
                                    <b><span class="modifier">Public</span> configure</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>configure(config: <a href="../classes/AuthConfig.html">AuthConfig</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="102" class="link-to-prism">src/oauth-service.ts:102</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Use this method to configure the service</p>
            </div>
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>config</td>
                                                              <td>
                                                              </td>
                                                              <td><p>the configuration</p>
            </td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="createAndSaveNonce"></a>
                                    <b><span class="modifier">Public</span> createAndSaveNonce</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>createAndSaveNonce()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1424" class="link-to-prism">src/oauth-service.ts:1424</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;string&gt;</code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="createNonce"></a>
                                    <b><span class="modifier">Protected</span> createNonce</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play circle"></span>
                                    <code>createNonce()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1432" class="link-to-prism">src/oauth-service.ts:1432</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;string&gt;</code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="fetchTokenUsingPasswordFlow"></a>
                                    <b><span class="modifier">Public</span> fetchTokenUsingPasswordFlow</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>fetchTokenUsingPasswordFlow(userName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, password: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, headers: <a href="../s/rs.html">Headers</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="525" class="link-to-prism">src/oauth-service.ts:525</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Uses password flow to exchange userName and password for an access_token.</p>
            </div>
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>userName</td>
                                                              <td>
                                                              </td>
                                                              <td></td>
                                                            </tr>
                                                            <tr>
                                                              <td>password</td>
                                                              <td>
                                                              </td>
                                                              <td></td>
                                                            </tr>
                                                            <tr>
                                                              <td>headers</td>
                                                              <td>
                                                              </td>
                                                              <td><p>Optional additional http-headers.</p>
            </td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;object&gt;</code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="fetchTokenUsingPasswordFlowAndLoadUserProfile"></a>
                                    <b><span class="modifier">Public</span> fetchTokenUsingPasswordFlowAndLoadUserProfile</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>fetchTokenUsingPasswordFlowAndLoadUserProfile(userName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, password: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, headers: <a href="../s/rs.html">Headers</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="458" class="link-to-prism">src/oauth-service.ts:458</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Uses password flow to exchange userName and password for an
            access_token. After receiving the access_token, this method
            uses it to query the userinfo endpoint in order to get information
            about the user in question.</p>
            <p>When using this, make sure that the property oidc is set to false.
            Otherwise stricter validations take happen that makes this operation
            fail.</p>
            </div>
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>userName</td>
                                                              <td>
                                                              </td>
                                                              <td></td>
                                                            </tr>
                                                            <tr>
                                                              <td>password</td>
                                                              <td>
                                                              </td>
                                                              <td></td>
                                                            </tr>
                                                            <tr>
                                                              <td>headers</td>
                                                              <td>
                                                              </td>
                                                              <td><p>Optional additional http-headers.</p>
            </td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;object&gt;</code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="getAccessToken"></a>
                                    <b><span class="modifier">Public</span> getAccessToken</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>getAccessToken()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1303" class="link-to-prism">src/oauth-service.ts:1303</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Returns the current access_token.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="getAccessTokenExpiration"></a>
                                    <b><span class="modifier">Public</span> getAccessTokenExpiration</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>getAccessTokenExpiration()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1311" class="link-to-prism">src/oauth-service.ts:1311</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Returns the expiration date of the access_token
            as milliseconds since 1970.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="getIdentityClaims"></a>
                                    <b><span class="modifier">Public</span> getIdentityClaims</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>getIdentityClaims()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1280" class="link-to-prism">src/oauth-service.ts:1280</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Returns the received claims about the user.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/object" target="_blank" >object</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="getIdToken"></a>
                                    <b><span class="modifier">Public</span> getIdToken</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>getIdToken()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1289" class="link-to-prism">src/oauth-service.ts:1289</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Returns the current id_token.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="getIdTokenExpiration"></a>
                                    <b><span class="modifier">Public</span> getIdTokenExpiration</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>getIdTokenExpiration()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1329" class="link-to-prism">src/oauth-service.ts:1329</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Returns the expiration date of the id_token
            as milliseconds since 1970.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="getSessionState"></a>
                                    <b><span class="modifier">Protected</span> getSessionState</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play circle"></span>
                                    <code>getSessionState()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1140" class="link-to-prism">src/oauth-service.ts:1140</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="hasValidAccessToken"></a>
                                    <b><span class="modifier">Public</span> hasValidAccessToken</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>hasValidAccessToken()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1339" class="link-to-prism">src/oauth-service.ts:1339</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Checkes, whether there is a valid access_token.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="hasValidIdToken"></a>
                                    <b><span class="modifier">Public</span> hasValidIdToken</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>hasValidIdToken()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1357" class="link-to-prism">src/oauth-service.ts:1357</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Checkes, whether there is a valid id_token.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="initImplicitFlow"></a>
                                    <b><span class="modifier">Public</span> initImplicitFlow</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>initImplicitFlow(additionalState: , params: string|object)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="966" class="link-to-prism">src/oauth-service.ts:966</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Starts the implicit flow and redirects to user to
            the auth servers login url.</p>
            </div>
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>additionalState</td>
                                                              <td>
                                                              </td>
                                                              <td><p>Optinal state that is passes around.
            You find this state in the property <code>state</code> after <code>tryLogin</code> logged in the user.</p>
            </td>
                                                            </tr>
                                                            <tr>
                                                              <td>params</td>
                                                              <td>
                                                              </td>
                                                              <td><p>Hash with additional parameter. If it is a string, it is used for the 
            parameter loginHint (for the sake of compatibility with former versions)</p>
            </td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="loadDiscoveryDocument"></a>
                                    <b><span class="modifier">Public</span> loadDiscoveryDocument</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>loadDiscoveryDocument(fullUrl: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="301" class="link-to-prism">src/oauth-service.ts:301</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Loads the discovery document to configure most
            properties of this service. The url of the discovery
            document is infered from the issuer&#39;s url according
            to the OpenId Connect spec. To use another url you
            can pass it to to optional parameter fullUrl.</p>
            </div>
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>fullUrl</td>
                                                              <td>
                                                              </td>
                                                              <td></td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;object&gt;</code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="loadDiscoveryDocumentAndTryLogin"></a>
                                    <b><span class="modifier">Public</span> loadDiscoveryDocumentAndTryLogin</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>loadDiscoveryDocumentAndTryLogin()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="155" class="link-to-prism">src/oauth-service.ts:155</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="loadUserProfile"></a>
                                    <b><span class="modifier">Public</span> loadUserProfile</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>loadUserProfile()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="474" class="link-to-prism">src/oauth-service.ts:474</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Loads the user profile by accessing the user info endpoint defined by OpenId Connect.</p>
            <p>When using this with OAuth2 password flow, make sure that the property oidc is set to false.
            Otherwise stricter validations take happen that makes this operation
            fail.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;object&gt;</code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="logOut"></a>
                                    <b><span class="modifier">Public</span> logOut</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>logOut(noRedirectToLogoutUrl: )</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1386" class="link-to-prism">src/oauth-service.ts:1386</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Removes all tokens and logs the user out.
            If a logout url is configured, the user is
            redirected to it.</p>
            </div>
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>noRedirectToLogoutUrl</td>
                                                              <td>
                                                              </td>
                                                              <td></td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="processIdToken"></a>
                                    <b><span class="modifier">Public</span> processIdToken</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>processIdToken(idToken: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, accessToken: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1153" class="link-to-prism">src/oauth-service.ts:1153</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;&gt;</code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="refreshToken"></a>
                                    <b><span class="modifier">Public</span> refreshToken</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>refreshToken()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="572" class="link-to-prism">src/oauth-service.ts:572</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Refreshes the token using a refresh_token.
            This does not work for implicit flow, b/c
            there is no refresh_token in this flow.
            A solution for this is provided by the
            method silentRefresh.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;object&gt;</code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="restartSessionChecksIfStillLoggedIn"></a>
                                    <b><span class="modifier">Public</span> restartSessionChecksIfStillLoggedIn</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>restartSessionChecksIfStillLoggedIn()</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="119" class="link-to-prism">src/oauth-service.ts:119</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="setStorage"></a>
                                    <b><span class="modifier">Public</span> setStorage</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>setStorage(storage: <a href="../classes/OAuthStorage.html">OAuthStorage</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="287" class="link-to-prism">src/oauth-service.ts:287</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Sets a custom storage used to store the received
            tokens on client side. By default, the browser&#39;s
            sessionStorage is used.</p>
            </div>
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>storage</td>
                                                              <td>
                                                              </td>
                                                              <td></td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="setupAutomaticSilentRefresh"></a>
                                    <b><span class="modifier">Public</span> setupAutomaticSilentRefresh</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>setupAutomaticSilentRefresh(params: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/object" target="_blank">object</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="142" class="link-to-prism">src/oauth-service.ts:142</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>params</td>
                                                              <td>
                                                              </td>
                                                              <td><p>Additional parameter to pass</p>
            </td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="silentRefresh"></a>
                                    <b><span class="modifier">Public</span> silentRefresh</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>silentRefresh(params: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/object" target="_blank">object</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="659" class="link-to-prism">src/oauth-service.ts:659</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Performs a silent refresh for implicit flow.
            Use this method to get a new tokens when/ before
            the existing tokens expires.</p>
            </div>
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;&gt;</code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="storeIdToken"></a>
                                    <b><span class="modifier">Protected</span> storeIdToken</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play circle"></span>
                                    <code>storeIdToken(idToken: <a href="../interfaces/ParsedIdToken.html">ParsedIdToken</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1129" class="link-to-prism">src/oauth-service.ts:1129</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="storeSessionState"></a>
                                    <b><span class="modifier">Protected</span> storeSessionState</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play circle"></span>
                                    <code>storeSessionState(sessionState: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1136" class="link-to-prism">src/oauth-service.ts:1136</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
            
                                        <div class="io-description">
                                            <b>Returns : </b>    <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>
            
                                        </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="tryLogin"></a>
                                    <b><span class="modifier">Public</span> tryLogin</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                        <span class="modifier-icon method fa fa-play "></span>
                                    <code>tryLogin(options: <a href="../classes/LoginOptions.html">LoginOptions</a>)</code>
                                </td>
                            </tr>
            
            
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="1027" class="link-to-prism">src/oauth-service.ts:1027</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                        <div class="io-description"><p>Checks whether there are tokens in the hash fragment
            as a result of the implicit flow. These tokens are
            parsed, validated and used to sign the user in to the
            current client.</p>
            </div>
            
                                        <div class="io-description">
                                                <b>Parameters :</b>
                                                <table class="params">
                                                    <thead>
                                                        <tr>
                                                            <td>Name</td>
                                                            <td>Type</td>
                                                            <td>Description</td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                            <tr>
                                                              <td>options</td>
                                                              <td>
                                                              </td>
                                                              <td><p>Optinal options.</p>
            </td>
                                                            </tr>
                                                    </tbody>
                                                </table>
                                        </div>
                                        <div>
                                        </div>
                                        <div class="io-description">
                                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>
            
                                        </div>
                                            <div class="io-description">
                                                
                                            </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>

            <section>
                
                    <h3 id="inputs">
                        Properties
                    </h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="events"></a>
                                    <b><span class="modifier">Public</span> events</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                    <span class="modifier-icon fa fa-"></span><code>events:     <code><a href="../classes/OAuthEvent.html" target="_self" >Observable&lt;OAuthEvent&gt;</a></code>
            </code>
                                </td>
                            </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <i>Type : </i>    <code><a href="../classes/OAuthEvent.html" target="_self" >Observable&lt;OAuthEvent&gt;</a></code>
            
                                    </td>
                                </tr>
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="47" class="link-to-prism">src/oauth-service.ts:47</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Informs about events, like token_received or token_expires.
            See the string enum EventType for a full list of events.</p>
            </div>
                                </td>
                            </tr>
            
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="state"></a>
                                    <b><span class="modifier">Public</span> state</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                    <span class="modifier-icon fa fa-"></span><code>state:     <code></code>
            </code>
                                </td>
                            </tr>
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="53" class="link-to-prism">src/oauth-service.ts:53</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The received (passed around) state, when logging
            in with implicit flow.</p>
            </div>
                                </td>
                            </tr>
            
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <tr>
                                <td class="col-md-4">
                                    <a name="tokenValidationHandler"></a>
                                    <b><span class="modifier">Public</span> tokenValidationHandler</b>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-md-4">
                                    <span class="modifier-icon fa fa-"></span><code>tokenValidationHandler:     <code><a href="../classes/ValidationHandler.html" target="_self" >ValidationHandler</a></code>
            </code>
                                </td>
                            </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <i>Type : </i>    <code><a href="../classes/ValidationHandler.html" target="_self" >ValidationHandler</a></code>
            
                                    </td>
                                </tr>
                                    <tr>
                                        <td class="col-md-4">
                                            <div class="io-line">Defined in <a href="" data-line="29" class="link-to-prism">src/oauth-service.ts:29</a></div>
                                        </td>
                                    </tr>
            
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>The ValidationHandler used to validate received
            id_tokens.</p>
            </div>
                                </td>
                            </tr>
            
                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade tab-source-code" id="source">
        <pre class="line-numbers"><code class="language-typescript">import { Http, URLSearchParams, Headers } from &#x27;@angular/http&#x27;;
import { Injectable, Optional } from &#x27;@angular/core&#x27;;
import { Observable } from &#x27;rxjs/Observable&#x27;;
import { Subject } from &#x27;rxjs/Subject&#x27;;
import { ValidationHandler, ValidationParams } from &#x27;./token-validation/validation-handler&#x27;;
import { UrlHelperService } from &#x27;./url-helper.service&#x27;;
import { Subscription } from &#x27;rxjs/Subscription&#x27;;
import { OAuthEvent, OAuthInfoEvent, OAuthErrorEvent, OAuthSuccessEvent } from &#x27;./events&#x27;;
import { OAuthStorage, LoginOptions, ParsedIdToken } from &#x27;./types&#x27;;
import { b64DecodeUnicode } from &#x27;./base64-helper&#x27;;
import { AuthConfig } from &#x27;./auth.config&#x27;;

/**
 * Service for logging in and logging out with
 * OIDC and OAuth2. Supports implicit flow and
 * password flow.
 */
@Injectable()
export class OAuthService
                extends AuthConfig {

    // extending AuthConfig ist just for LEGACY reasons
    // to not break existing code

    /**
     * The ValidationHandler used to validate received
     * id_tokens.
     */
    public tokenValidationHandler: ValidationHandler;

    /**
     * @internal
     * Deprecated:  use property events instead
     */
    public discoveryDocumentLoaded &#x3D; false;

    /**
     * @internal
     * Deprecated:  use property events instead
     */
    public discoveryDocumentLoaded$: Observable&lt;object&gt;;

    /**
     * Informs about events, like token_received or token_expires.
     * See the string enum EventType for a full list of events.
     */
    public events: Observable&lt;OAuthEvent&gt;;

    /**
     * The received (passed around) state, when logging
     * in with implicit flow.
     */
    public state? &#x3D; &#x27;&#x27;;

    private eventsSubject: Subject&lt;OAuthEvent&gt; &#x3D; new Subject&lt;OAuthEvent&gt;();
    private discoveryDocumentLoadedSubject: Subject&lt;object&gt; &#x3D; new Subject&lt;object&gt;();
    private silentRefreshPostMessageEventListener: EventListener;
    private grantTypesSupported: Array&lt;string&gt; &#x3D; [];
    private _storage: OAuthStorage;
    private accessTokenTimeoutSubscription: Subscription;
    private idTokenTimeoutSubscription: Subscription;
    private sessionCheckEventListener: EventListener;
    private jwksUri: string;
    private sessionCheckTimer: any;
    private silentRefreshSubject: string;

    constructor(
        private http: Http,
        @Optional() storage: OAuthStorage,
        @Optional() tokenValidationHandler: ValidationHandler,
        @Optional() private config: AuthConfig,
        private urlHelper: UrlHelperService) {

        super();

        this.discoveryDocumentLoaded$ &#x3D; this.discoveryDocumentLoadedSubject.asObservable();
        this.events &#x3D; this.eventsSubject.asObservable();

        if (tokenValidationHandler) {
            this.tokenValidationHandler &#x3D; tokenValidationHandler;
        }

        if (config) {
            this.configure(config);
        }

        if (storage) {
            this.setStorage(storage);
        } else if (typeof sessionStorage !&#x3D;&#x3D; &#x27;undefined&#x27;) {
            this.setStorage(sessionStorage);
        }

        this.setupRefreshTimer();

        
    }

    /**
     * Use this method to configure the service
     * @param config the configuration
     */
    public configure(config: AuthConfig) {
        // For the sake of downward compatibility with
        // original configuration API
        Object.assign(this, new AuthConfig(), config);

        this.config &#x3D; config;

        if (this.sessionChecksEnabled) {
            this.setupSessionCheck();
        }

        this.configChanged();
    }

    private configChanged(): void {
    }

    public restartSessionChecksIfStillLoggedIn(): void {
        if (this.hasValidIdToken()) {
            this.initSessionCheck();
        }
    }

    private restartRefreshTimerIfStillLoggedIn(): void {
        this.setupExpirationTimers();
    }

    private setupSessionCheck() {
        this
            .events
            .filter(e &#x3D;&gt; e.type &#x3D;&#x3D;&#x3D; &#x27;token_received&#x27;)
            .subscribe(e &#x3D;&gt; {
                this.initSessionCheck();
            });
    }

    /**
     * 
     * @param params Additional parameter to pass
     */
    public setupAutomaticSilentRefresh(params: object &#x3D; {}) {
        this
        .events
        .filter(e &#x3D;&gt; e.type &#x3D;&#x3D;&#x3D; &#x27;token_expires&#x27;)
        .subscribe(e &#x3D;&gt; {
          this.silentRefresh(params).catch(_ &#x3D;&gt; {
              this.debug(&#x27;automatic silent refresh did not work&#x27;);
          })
        });

        this.restartRefreshTimerIfStillLoggedIn();
    }

    public loadDiscoveryDocumentAndTryLogin() {
        return this.loadDiscoveryDocument().then((doc) &#x3D;&gt; {
            return this.tryLogin();
        });
    }

    private debug(...args): void {
        if (this.showDebugInformation) {
            console.debug.apply(console, args);
        }
    }

    private validateUrlFromDiscoveryDocument(url: string): string[] {

        let errors: string[] &#x3D; [];
        let httpsCheck &#x3D; this.validateUrlForHttps(url);
        let issuerCheck &#x3D; this.validateUrlAgainstIssuer(url);

        if (!httpsCheck) {
            errors.push(&#x27;https for all urls required. Also for urls received by discovery.&#x27;);
        }

        if (!issuerCheck) {
            errors.push(&#x27;Every url in discovery document has to start with the issuer url.&#x27;
                        + &#x27;Also see property strictDiscoveryDocumentValidation.&#x27;);
        }

        return errors;
    }

    private validateUrlForHttps(url: string): boolean {

        if (!url) return true;

        let lcUrl &#x3D; url.toLowerCase();

        if (this.requireHttps &#x3D;&#x3D;&#x3D; false) return true;

        if ((lcUrl.match(/^http:\/\/localhost($|[:\/])/)
            || lcUrl.match(/^http:\/\/localhost($|[:\/])/))
            &amp;&amp; this.requireHttps &#x3D;&#x3D;&#x3D; &#x27;remoteOnly&#x27;) {
                return true;
        }

        return lcUrl.startsWith(&#x27;https://&#x27;);
    }

    private validateUrlAgainstIssuer(url: string) {
        if (!this.strictDiscoveryDocumentValidation) return true;
        if (!url) return true;
        return url.toLowerCase().startsWith(this.issuer.toLowerCase());
    }

    private setupRefreshTimer(): void {

        if (typeof window &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
            this.debug(&#x27;timer not supported on this plattform&#x27;);
            return;
        }

        this.events.filter(e &#x3D;&gt; e.type &#x3D;&#x3D;&#x3D; &#x27;token_received&#x27;).subscribe(_ &#x3D;&gt; {

            this.clearAccessTokenTimer();
            this.clearIdTokenTimer();
            this.setupExpirationTimers();

        });
    }

    private setupExpirationTimers(): void {
        let idTokenExp &#x3D; this.getIdTokenExpiration() || Number.MAX_VALUE;
        let accessTokenExp &#x3D; this.getAccessTokenExpiration() || Number.MAX_VALUE;
        let useAccessTokenExp &#x3D; accessTokenExp &lt;&#x3D; idTokenExp;

        if (this.hasValidAccessToken() &amp;&amp; useAccessTokenExp ) {
            this.setupAccessTokenTimer();
        }

        if (this.hasValidIdToken() &amp;&amp; !useAccessTokenExp ) {
            this.setupIdTokenTimer();
        }
    }

    private setupAccessTokenTimer(): void {
        let expiration &#x3D; this.getAccessTokenExpiration();
        let storedAt &#x3D; this.getAccessTokenStoredAt();
        let timeout &#x3D; this.calcTimeout(storedAt, expiration);

        this.accessTokenTimeoutSubscription &#x3D;
            Observable
                .of(new OAuthInfoEvent(&#x27;token_expires&#x27;, &#x27;access_token&#x27;))
                .delay(timeout)
                .subscribe(e &#x3D;&gt; this.eventsSubject.next(e));
    }


    private setupIdTokenTimer(): void {
        let expiration &#x3D; this.getIdTokenExpiration();
        let storedAt &#x3D; this.getIdTokenStoredAt();
        let timeout &#x3D; this.calcTimeout(storedAt, expiration);

        this.idTokenTimeoutSubscription &#x3D;
            Observable
                .of(new OAuthInfoEvent(&#x27;token_expires&#x27;, &#x27;id_token&#x27;))
                .delay(timeout)
                .subscribe(e &#x3D;&gt; this.eventsSubject.next(e));
    }

    private clearAccessTokenTimer(): void {
        if (this.accessTokenTimeoutSubscription) {
            this.accessTokenTimeoutSubscription.unsubscribe();
        }
    }

    private clearIdTokenTimer(): void {
        if (this.idTokenTimeoutSubscription) {
            this.idTokenTimeoutSubscription.unsubscribe();
        }
    }

    private calcTimeout(storedAt: number, expiration: number): number {
        let delta &#x3D; (expiration - storedAt) * this.timeoutFactor;
        return delta;
    }

    /**
     * Sets a custom storage used to store the received
     * tokens on client side. By default, the browser&#x27;s
     * sessionStorage is used.
     *
     * @param storage
     */
    public setStorage(storage: OAuthStorage): void {
        this._storage &#x3D; storage;
        this.configChanged();
    }

    /**
     * Loads the discovery document to configure most
     * properties of this service. The url of the discovery
     * document is infered from the issuer&#x27;s url according
     * to the OpenId Connect spec. To use another url you
     * can pass it to to optional parameter fullUrl.
     *
     * @param fullUrl
     */
    public loadDiscoveryDocument(fullUrl: string &#x3D; null): Promise&lt;object&gt; {

        return new Promise((resolve, reject) &#x3D;&gt; {

            if (!fullUrl) {
                fullUrl &#x3D; this.issuer || &#x27;&#x27;;
                if (!fullUrl.endsWith(&#x27;/&#x27;)) {
                    fullUrl +&#x3D; &#x27;/&#x27;;
                }               
                fullUrl +&#x3D; &#x27;.well-known/openid-configuration&#x27;;
            }

            if (!this.validateUrlForHttps(fullUrl)) {
                reject(&#x27;loginUrl must use Http. Also check property requireHttps.&#x27;);
                return;
            }

            this.http.get(fullUrl).map(r &#x3D;&gt; r.json()).subscribe(
                (doc) &#x3D;&gt; {

                    if (!this.validateDiscoveryDocument(doc)) {
                        this.eventsSubject.next(new OAuthErrorEvent(&#x27;discovery_document_validation_error&#x27;, null));
                        reject(&#x27;discovery_document_validation_error&#x27;);
                        return;
                    }

                    this.loginUrl &#x3D; doc.authorization_endpoint;
                    this.logoutUrl &#x3D; doc.end_session_endpoint;
                    this.grantTypesSupported &#x3D; doc.grant_types_supported;
                    this.issuer &#x3D; doc.issuer;
                    this.tokenEndpoint &#x3D; doc.token_endpoint;
                    this.userinfoEndpoint &#x3D; doc.userinfo_endpoint;
                    this.jwksUri &#x3D; doc.jwks_uri;
                    this.sessionCheckIFrameUrl &#x3D; doc.check_session_iframe;

                    this.discoveryDocumentLoaded &#x3D; true;
                    this.discoveryDocumentLoadedSubject.next(doc);

                    if (this.sessionChecksEnabled) {
                        this.restartSessionChecksIfStillLoggedIn();
                    }

                    this.loadJwks().then(jwks &#x3D;&gt; {
                        let result: object &#x3D; {
                            discoveryDocument: doc,
                            jwks: jwks
                        };

                        let event &#x3D; new OAuthSuccessEvent(&#x27;discovery_document_loaded&#x27;, result);
                        this.eventsSubject.next(event);
                        resolve(event);
                        return;
                    }).catch(err &#x3D;&gt; {
                        this.eventsSubject.next(new OAuthErrorEvent(&#x27;discovery_document_load_error&#x27;, err));
                        reject(err);
                        return;
                    });
                },
                (err) &#x3D;&gt; {
                    console.error(&#x27;error loading dicovery document&#x27;, err);
                    this.eventsSubject.next(new OAuthErrorEvent(&#x27;discovery_document_load_error&#x27;, err));
                    reject(err);
                }
            );
        });
    }

    private loadJwks(): Promise&lt;object&gt; {
        return new Promise&lt;object&gt;((resolve, reject) &#x3D;&gt; {
            if (this.jwksUri) {
                this.http.get(this.jwksUri).map(r &#x3D;&gt; r.json()).subscribe(
                    jwks &#x3D;&gt; {
                        this.jwks &#x3D; jwks;
                        this.eventsSubject.next(new OAuthSuccessEvent(&#x27;discovery_document_loaded&#x27;));
                        resolve(jwks);
                    },
                    err &#x3D;&gt; {
                        console.error(&#x27;error loading jwks&#x27;, err);
                        this.eventsSubject.next(new OAuthErrorEvent(&#x27;jwks_load_error&#x27;, err));
                        reject(err);
                    }
                );
            }
            else {
                resolve(null);
            }
        });

    }

    private validateDiscoveryDocument(doc: object): boolean {

        let errors: string[];

        if (doc[&#x27;issuer&#x27;] !&#x3D;&#x3D; this.issuer) {
            console.error(
                &#x27;invalid issuer in discovery document&#x27;,
                &#x27;expected: &#x27; + this.issuer,
                &#x27;current: &#x27; + doc[&#x27;issuer&#x27;]
            );
            return false;
        }

        errors &#x3D; this.validateUrlFromDiscoveryDocument(doc[&#x27;authorization_endpoint&#x27;]);
        if (errors.length &gt; 0) {
            console.error(&#x27;error validating authorization_endpoint in discovery document&#x27;, errors);
            return false;
        }

        errors &#x3D; this.validateUrlFromDiscoveryDocument(doc[&#x27;end_session_endpoint&#x27;]);
        if (errors.length &gt; 0) {
            console.error(&#x27;error validating end_session_endpoint in discovery document&#x27;, errors);
            return false;
        }

        errors &#x3D; this.validateUrlFromDiscoveryDocument(doc[&#x27;token_endpoint&#x27;]);
        if (errors.length &gt; 0) {
            console.error(&#x27;error validating token_endpoint in discovery document&#x27;, errors);
        }

        errors &#x3D; this.validateUrlFromDiscoveryDocument(doc[&#x27;userinfo_endpoint&#x27;]);
        if (errors.length &gt; 0) {
            console.error(&#x27;error validating userinfo_endpoint in discovery document&#x27;, errors);
            return false;
        }

        errors &#x3D; this.validateUrlFromDiscoveryDocument(doc[&#x27;jwks_uri&#x27;]);
        if (errors.length &gt; 0) {
            console.error(&#x27;error validating jwks_uri in discovery document&#x27;, errors);
            return false;
        }

        if (this.sessionChecksEnabled &amp;&amp;  !doc[&#x27;check_session_iframe&#x27;]) {
            console.warn(
                &#x27;sessionChecksEnabled is activated but discovery document&#x27;
                + &#x27; does not contain a check_session_iframe field&#x27;);
        }

        this.sessionChecksEnabled &#x3D; doc[&#x27;check_session_iframe&#x27;];

        return true;
    }

    /**
     * Uses password flow to exchange userName and password for an
     * access_token. After receiving the access_token, this method
     * uses it to query the userinfo endpoint in order to get information
     * about the user in question.
     *
     * When using this, make sure that the property oidc is set to false.
     * Otherwise stricter validations take happen that makes this operation
     * fail.
     *
     * @param userName
     * @param password
     * @param headers Optional additional http-headers.
     */
    public fetchTokenUsingPasswordFlowAndLoadUserProfile(
        userName: string,
        password: string,
        headers: Headers &#x3D; new Headers()): Promise&lt;object&gt; {
        return this
                .fetchTokenUsingPasswordFlow(userName, password, headers)
                .then(() &#x3D;&gt; this.loadUserProfile());
    }

    /**
     * Loads the user profile by accessing the user info endpoint defined by OpenId Connect.
     *
     * When using this with OAuth2 password flow, make sure that the property oidc is set to false.
     * Otherwise stricter validations take happen that makes this operation
     * fail.
     */
    public loadUserProfile(): Promise&lt;object&gt; {
        if (!this.hasValidAccessToken()) {
            throw new Error(&#x27;Can not load User Profile without access_token&#x27;);
        }
        if (!this.validateUrlForHttps(this.userinfoEndpoint)) {
            throw new Error(&#x27;userinfoEndpoint must use Http. Also check property requireHttps.&#x27;);
        }

        return new Promise((resolve, reject) &#x3D;&gt; {

            let headers &#x3D; new Headers();
            headers.set(&#x27;Authorization&#x27;, &#x27;Bearer &#x27; + this.getAccessToken());

            this.http.get(this.userinfoEndpoint, { headers }).map(r &#x3D;&gt; r.json()).subscribe(
                (doc) &#x3D;&gt; {
                    this.debug(&#x27;userinfo received&#x27;, doc);

                    let existingClaims &#x3D; this.getIdentityClaims() || {};
                    
                    if (!this.skipSubjectCheck) {
                        if (this.oidc &amp;&amp; (!existingClaims[&#x27;sub&#x27;] || doc.sub !&#x3D;&#x3D; existingClaims[&#x27;sub&#x27;])) {
                            let err &#x3D; &#x27;if property oidc is true, the received user-id (sub) has to be the user-id &#x27;
                                        + &#x27;of the user that has logged in with oidc.\n&#x27;
                                        + &#x27;if you are not using oidc but just oauth2 password flow set oidc to false&#x27;;

                            reject(err);
                            return;
                        }
                    }

                    doc &#x3D; Object.assign({}, existingClaims, doc);

                    this._storage.setItem(&#x27;id_token_claims_obj&#x27;, JSON.stringify(doc));
                    this.eventsSubject.next(new OAuthSuccessEvent(&#x27;user_profile_loaded&#x27;));
                    resolve(doc);
                },
                (err) &#x3D;&gt; {
                    console.error(&#x27;error loading user info&#x27;, err);
                    this.eventsSubject.next(new OAuthErrorEvent(&#x27;user_profile_load_error&#x27;, err));
                    reject(err);
                }
            );
        });
    }

    /**
     * Uses password flow to exchange userName and password for an access_token.
     * @param userName
     * @param password
     * @param headers Optional additional http-headers.
     */
    public fetchTokenUsingPasswordFlow(userName: string, password: string, headers: Headers &#x3D; new Headers()): Promise&lt;object&gt; {

        if (!this.validateUrlForHttps(this.tokenEndpoint)) {
            throw new Error(&#x27;tokenEndpoint must use Http. Also check property requireHttps.&#x27;);
        }

        return new Promise((resolve, reject) &#x3D;&gt; {
            let search &#x3D; new URLSearchParams();
            search.set(&#x27;grant_type&#x27;, &#x27;password&#x27;);
            search.set(&#x27;client_id&#x27;, this.clientId);
            search.set(&#x27;scope&#x27;, this.scope);
            search.set(&#x27;username&#x27;, userName);
            search.set(&#x27;password&#x27;, password);

            if (this.dummyClientSecret) {
                search.set(&#x27;client_secret&#x27;, this.dummyClientSecret);
            }

            headers.set(&#x27;Content-Type&#x27;, &#x27;application/x-www-form-urlencoded&#x27;);

            let params &#x3D; search.toString();

            this.http.post(this.tokenEndpoint, params, { headers }).map(r &#x3D;&gt; r.json()).subscribe(
                (tokenResponse) &#x3D;&gt; {
                    this.debug(&#x27;tokenResponse&#x27;, tokenResponse);
                    this.storeAccessTokenResponse(tokenResponse.access_token, tokenResponse.refresh_token, tokenResponse.expires_in);

                    this.eventsSubject.next(new OAuthSuccessEvent(&#x27;token_received&#x27;));
                    resolve(tokenResponse);
                },
                (err) &#x3D;&gt; {
                    console.error(&#x27;Error performing password flow&#x27;, err);
                    this.eventsSubject.next(new OAuthErrorEvent(&#x27;token_error&#x27;, err));
                    reject(err);
                }
            );
        });

    }

    /**
     * Refreshes the token using a refresh_token.
     * This does not work for implicit flow, b/c
     * there is no refresh_token in this flow.
     * A solution for this is provided by the
     * method silentRefresh.
     */
    public refreshToken(): Promise&lt;object&gt; {

        if (!this.validateUrlForHttps(this.tokenEndpoint)) {
            throw new Error(&#x27;tokenEndpoint must use Http. Also check property requireHttps.&#x27;);
        }

        return new Promise((resolve, reject) &#x3D;&gt; {
            let search &#x3D; new URLSearchParams();
            search.set(&#x27;grant_type&#x27;, &#x27;refresh_token&#x27;);
            search.set(&#x27;client_id&#x27;, this.clientId);
            search.set(&#x27;scope&#x27;, this.scope);
            search.set(&#x27;refresh_token&#x27;, this._storage.getItem(&#x27;refresh_token&#x27;));

            if (this.dummyClientSecret) {
                search.set(&#x27;client_secret&#x27;, this.dummyClientSecret);
            }

            let headers &#x3D; new Headers();
            headers.set(&#x27;Content-Type&#x27;, &#x27;application/x-www-form-urlencoded&#x27;);

            let params &#x3D; search.toString();

            this.http.post(this.tokenEndpoint, params, { headers }).map(r &#x3D;&gt; r.json()).subscribe(
                (tokenResponse) &#x3D;&gt; {
                    this.debug(&#x27;refresh tokenResponse&#x27;, tokenResponse);
                    this.storeAccessTokenResponse(tokenResponse.access_token, tokenResponse.refresh_token, tokenResponse.expires_in);

                    this.eventsSubject.next(new OAuthSuccessEvent(&#x27;token_received&#x27;));
                    this.eventsSubject.next(new OAuthSuccessEvent(&#x27;token_refreshed&#x27;));
                    resolve(tokenResponse);
                },
                (err) &#x3D;&gt; {
                    console.error(&#x27;Error performing password flow&#x27;, err);
                    this.eventsSubject.next(new OAuthErrorEvent(&#x27;token_refresh_error&#x27;, err));
                    reject(err);
                }
            );
        });
    }

    private removeSilentRefreshEventListener(): void {
        if (this.silentRefreshPostMessageEventListener) {
            window.removeEventListener(&#x27;message&#x27;, this.silentRefreshPostMessageEventListener);
            this.silentRefreshPostMessageEventListener &#x3D; null;
        }
    }

    private setupSilentRefreshEventListener(): void {
        this.removeSilentRefreshEventListener();

        this.silentRefreshPostMessageEventListener &#x3D; (e: MessageEvent) &#x3D;&gt; {

            let expectedPrefix &#x3D; &#x27;#&#x27;;

            if (this.silentRefreshMessagePrefix) {
                expectedPrefix +&#x3D; this.silentRefreshMessagePrefix;
            }

            if (!e || !e.data || typeof e.data !&#x3D;&#x3D; &#x27;string&#x27; ) return;

            let prefixedMessage: string &#x3D; e.data;

            if (!prefixedMessage.startsWith(expectedPrefix)) return;

            let message &#x3D; &#x27;#&#x27; + prefixedMessage.substr(expectedPrefix.length);

            this.tryLogin({
                customHashFragment: message,
                onLoginError: (err) &#x3D;&gt; {
                    this.eventsSubject.next(new OAuthErrorEvent(&#x27;silent_refresh_error&#x27;, err));
                },
                onTokenReceived: () &#x3D;&gt; {
                    this.eventsSubject.next(new OAuthSuccessEvent(&#x27;silently_refreshed&#x27;));
                }
            })
            .catch(err &#x3D;&gt; this.debug(&#x27;tryLogin during silent refresh failed&#x27;, err));
        };

        window.addEventListener(&#x27;message&#x27;, this.silentRefreshPostMessageEventListener);
    }


    /**
     * Performs a silent refresh for implicit flow.
     * Use this method to get a new tokens when/ before
     * the existing tokens expires.
     */
    public silentRefresh(params: object &#x3D; {}): Promise&lt;OAuthEvent&gt; {

        let claims &#x3D; this.getIdentityClaims();

        if (!claims) {
            throw new Error(&#x27;cannot perform a silent refresh as the user is not logged in&#x27;);
        }

        if (!this.validateUrlForHttps(this.loginUrl)) throw new Error(&#x27;tokenEndpoint must use Http. Also check property requireHttps.&#x27;);

        if (typeof document &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
            throw new Error(&#x27;silent refresh is not supported on this platform&#x27;);
        }

        let existingIframe &#x3D; document.getElementById(this.silentRefreshIFrameName);
        if (existingIframe) {
            document.body.removeChild(existingIframe);
        }

        this.silentRefreshSubject &#x3D; claims[&#x27;sub&#x27;];

        let iframe &#x3D; document.createElement(&#x27;iframe&#x27;);
        iframe.id &#x3D; this.silentRefreshIFrameName;

        this.setupSilentRefreshEventListener();

        let redirectUri &#x3D; this.silentRefreshRedirectUri || this.redirectUri;
        this.createLoginUrl(null, null, redirectUri, true, params).then(url &#x3D;&gt; {
            iframe.setAttribute(&#x27;src&#x27;, url);
            if (!this.silentRefreshShowIFrame) {
               iframe.style.visibility &#x3D; &#x27;hidden&#x27;;
            }
            document.body.appendChild(iframe);
        });

        let errors &#x3D; this.events.filter(e &#x3D;&gt; e instanceof OAuthErrorEvent).first();
        let success &#x3D; this.events.filter(e &#x3D;&gt; e.type &#x3D;&#x3D;&#x3D; &#x27;silently_refreshed&#x27;).first();
        let timeout &#x3D; Observable.of(new OAuthErrorEvent(&#x27;silent_refresh_timeout&#x27;, null))
                                .delay(this.silentRefreshTimeout || this.siletRefreshTimeout);

        return Observable
                .race([errors, success, timeout])
                .do(e &#x3D;&gt; {
                    if (e.type &#x3D;&#x3D;&#x3D; &#x27;silent_refresh_timeout&#x27;) {
                        this.eventsSubject.next(e);
                    }
                })
                .map(e &#x3D;&gt; {
                    if (e instanceof OAuthErrorEvent) {
                        throw e;
                    }
                    return e;
                })
                .toPromise();
    }

    private canPerformSessionCheck(): boolean {
        if (!this.sessionChecksEnabled) return false;
        if (!this.sessionCheckIFrameUrl) {
            console.warn(&#x27;sessionChecksEnabled is activated but there &#x27;
                            + &#x27;is no sessionCheckIFrameUrl&#x27;);
            return false;
        }
        let sessionState &#x3D; this.getSessionState();
        if (!sessionState) {
            console.warn(&#x27;sessionChecksEnabled is activated but there &#x27;
                + &#x27;is no session_state&#x27;);
            return false;
        }
        if (typeof document &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
            return false;
        }

        return true;
    }

    private setupSessionCheckEventListener(): void {
        this.removeSessionCheckEventListener();

        this.sessionCheckEventListener &#x3D; (e: MessageEvent) &#x3D;&gt; {

            let origin &#x3D; e.origin.toLowerCase();
            let issuer &#x3D; this.issuer.toLowerCase();

            this.debug(&#x27;sessionCheckEventListener&#x27;);

            if (!issuer.startsWith(origin)) {
                this.debug(
                    &#x27;sessionCheckEventListener&#x27;,
                    &#x27;wrong origin&#x27;,
                    origin,
                    &#x27;expected&#x27;,
                    issuer);
            }

            switch (e.data) {
                case &#x27;unchanged&#x27;: this.handleSessionUnchanged(); break;
                case &#x27;changed&#x27;: this.handleSessionChange(); break;
                case &#x27;error&#x27;: this.handleSessionError(); break;
            }

            this.debug(&#x27;got info from session check inframe&#x27;, e);
        };

        window.addEventListener(&#x27;message&#x27;, this.sessionCheckEventListener);
    }

    private handleSessionUnchanged(): void {
        this.debug(&#x27;session check&#x27;, &#x27;session unchanged&#x27;);
    }

    private handleSessionChange(): void {
        /* events: session_changed, relogin, stopTimer, logged_out*/
        this.eventsSubject.next(new OAuthInfoEvent(&#x27;session_changed&#x27;));
        this.stopSessionCheckTimer();
        if (this.silentRefreshRedirectUri) {
            this.silentRefresh()
                .catch(_ &#x3D;&gt; this.debug(&#x27;silent refresh failed after session changed&#x27;));
            this.waitForSilentRefreshAfterSessionChange();
        }
        else {
            this.eventsSubject.next(new OAuthInfoEvent(&#x27;session_terminated&#x27;));
            this.logOut(true);
        }
    }

    private waitForSilentRefreshAfterSessionChange() {
        this
            .events
            .filter((e: OAuthEvent) &#x3D;&gt;
                e.type &#x3D;&#x3D;&#x3D; &#x27;silently_refreshed&#x27;
                || e.type &#x3D;&#x3D;&#x3D; &#x27;silent_refresh_timeout&#x27;
                || e.type &#x3D;&#x3D;&#x3D; &#x27;silent_refresh_error&#x27;)
            .first()
            .subscribe(e &#x3D;&gt; {
                if (e.type !&#x3D;&#x3D; &#x27;silently_refreshed&#x27;) {
                    this.debug(&#x27;silent refresh did not work after session changed&#x27;);
                    this.eventsSubject.next(new OAuthInfoEvent(&#x27;session_terminated&#x27;));
                    this.logOut(true);
                }
            });
    }

    private handleSessionError(): void {
        this.stopSessionCheckTimer();
        this.eventsSubject.next(new OAuthInfoEvent(&#x27;session_error&#x27;));
    }

    private removeSessionCheckEventListener(): void {
        if (this.sessionCheckEventListener) {
            window.removeEventListener(&#x27;message&#x27;, this.sessionCheckEventListener);
            this.sessionCheckEventListener &#x3D; null;
        }
    }

    private initSessionCheck(): void {
        if (!this.canPerformSessionCheck()) return;

        let existingIframe &#x3D; document.getElementById(this.sessionCheckIFrameName);
        if (existingIframe) {
            document.body.removeChild(existingIframe);
        }

        let iframe &#x3D; document.createElement(&#x27;iframe&#x27;);
        iframe.id &#x3D; this.sessionCheckIFrameName;

        this.setupSessionCheckEventListener();

        let url &#x3D; this.sessionCheckIFrameUrl;
        iframe.setAttribute(&#x27;src&#x27;, url);
        iframe.style.visibility &#x3D; &#x27;hidden&#x27;;
        document.body.appendChild(iframe);

        this.startSessionCheckTimer();

    }

    private startSessionCheckTimer(): void {
        this.stopSessionCheckTimer();
        this.sessionCheckTimer &#x3D; setInterval(this.checkSession.bind(this), this.sessionCheckIntervall);
    }

    private stopSessionCheckTimer(): void {
        if (this.sessionCheckTimer) {
            clearInterval(this.sessionCheckTimer);
            this.sessionCheckTimer &#x3D; null;
        }
    }

    private checkSession(): void {
        let iframe: any &#x3D; document.getElementById(this.sessionCheckIFrameName);

        if (!iframe) {
            console.warn(&#x27;checkSession did not find iframe&#x27;, this.sessionCheckIFrameName);
        }

        let sessionState &#x3D; this.getSessionState();

        if (!sessionState) {
            this.stopSessionCheckTimer();
        }

        let message &#x3D; this.clientId + &#x27; &#x27; + sessionState;
        iframe.contentWindow.postMessage(message, this.issuer);
    }

    private createLoginUrl(
        state &#x3D; &#x27;&#x27;,
        loginHint &#x3D; &#x27;&#x27;,
        customRedirectUri &#x3D; &#x27;&#x27;,
        noPrompt &#x3D; false,
        params: object &#x3D; {}
    ) {
        let that &#x3D; this;

        let redirectUri: string;

        if (customRedirectUri) {
            redirectUri &#x3D; customRedirectUri;
        }
        else {
            redirectUri &#x3D; this.redirectUri;
        }

        return this.createAndSaveNonce().then((nonce: any) &#x3D;&gt; {

            if (state) {
                state &#x3D; nonce + &#x27;;&#x27; + state;
            }
            else {
                state &#x3D; nonce;
            }

            if (!this.requestAccessToken &amp;&amp; !this.oidc) {
                throw new Error(&#x27;Either requestAccessToken or oidc or both must be true&#x27;);
            }

            if (this.oidc &amp;&amp; this.requestAccessToken) {
                this.responseType &#x3D; &#x27;id_token token&#x27;;
            }
            else if (this.oidc &amp;&amp; !this.requestAccessToken) {
                this.responseType &#x3D; &#x27;id_token&#x27;;
            }
            else {
                this.responseType &#x3D; &#x27;token&#x27;;
            }

            let seperationChar &#x3D; (that.loginUrl.indexOf(&#x27;?&#x27;) &gt; -1) ? &#x27;&amp;&#x27; : &#x27;?&#x27;;

            let scope &#x3D; that.scope;

            if (this.oidc &amp;&amp; !scope.match(/(^|\s)openid($|\s)/)) {
                scope &#x3D; &#x27;openid &#x27; + scope;
            }

            let url &#x3D; that.loginUrl
                        + seperationChar
                        + &#x27;response_type&#x3D;&#x27;
                        + encodeURIComponent(that.responseType)
                        + &#x27;&amp;client_id&#x3D;&#x27;
                        + encodeURIComponent(that.clientId)
                        + &#x27;&amp;state&#x3D;&#x27;
                        + encodeURIComponent(state)
                        + &#x27;&amp;redirect_uri&#x3D;&#x27;
                        + encodeURIComponent(redirectUri)
                        + &#x27;&amp;scope&#x3D;&#x27;
                        + encodeURIComponent(scope);

            if (loginHint) {
                url +&#x3D; &#x27;&amp;login_hint&#x3D;&#x27; + encodeURIComponent(loginHint);
            }

            if (that.resource) {
                url +&#x3D; &#x27;&amp;resource&#x3D;&#x27; + encodeURIComponent(that.resource);
            }

            if (that.oidc) {
                url +&#x3D; &#x27;&amp;nonce&#x3D;&#x27; + encodeURIComponent(nonce);
            }

            if (noPrompt) {
                url +&#x3D; &#x27;&amp;prompt&#x3D;none&#x27;;
            }

            for(let key of Object.keys(params)) {
                url +&#x3D; &#x27;&amp;&#x27; + encodeURIComponent(key) + &#x27;&#x3D;&#x27; + encodeURIComponent(params[key]);
            }

            if (this.customQueryParams) {
                for (let key of Object.getOwnPropertyNames(this.customQueryParams)) {
                    url +&#x3D; &#x27;&amp;&#x27; + key + &#x27;&#x3D;&#x27; + encodeURIComponent(this.customQueryParams[key]);
                }
            }

            return url;
        });
    };

    /**
     * Starts the implicit flow and redirects to user to
     * the auth servers login url.
     *
     * @param additionalState Optinal state that is passes around.
     *  You find this state in the property &#x60;&#x60;state&#x60;&#x60; after &#x60;&#x60;tryLogin&#x60;&#x60; logged in the user.
     * @param params Hash with additional parameter. If it is a string, it is used for the 
     *               parameter loginHint (for the sake of compatibility with former versions)
     */
    public initImplicitFlow(additionalState &#x3D; &#x27;&#x27;, params: string | object &#x3D; &#x27;&#x27;): void {

        if (!this.validateUrlForHttps(this.loginUrl)) {
            throw new Error(&#x27;loginUrl must use Http. Also check property requireHttps.&#x27;);
        }

        let addParams: object &#x3D; {};
        let loginHint: string &#x3D; null;

        if (typeof params &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
            loginHint &#x3D; params;
        }
        else if (typeof params &#x3D;&#x3D;&#x3D; &#x27;object&#x27;) {
            addParams &#x3D; params;
        }

        this.createLoginUrl(additionalState, loginHint, null, false, addParams).then(function (url) {
            location.href &#x3D; url;
        })
        .catch(error &#x3D;&gt; {
            console.error(&#x27;Error in initImplicitFlow&#x27;);
            console.error(error);
        });
    };

    private callOnTokenReceivedIfExists(options: LoginOptions): void {
        let that &#x3D; this;
        if (options.onTokenReceived) {
            let tokenParams &#x3D; {
                idClaims: that.getIdentityClaims(),
                idToken: that.getIdToken(),
                accessToken: that.getAccessToken(),
                state: that.state
            };
            options.onTokenReceived(tokenParams);
        }
    }

    private storeAccessTokenResponse(accessToken: string, refreshToken: string, expiresIn: number): void {
        this._storage.setItem(&#x27;access_token&#x27;, accessToken);
        this._storage.setItem(&#x27;access_token_stored_at&#x27;, &#x27;&#x27; + Date.now());
        if (expiresIn) {
            let expiresInMilliSeconds &#x3D; expiresIn * 1000;
            let now &#x3D; new Date();
            let expiresAt &#x3D; now.getTime() + expiresInMilliSeconds;
            this._storage.setItem(&#x27;expires_at&#x27;, &#x27;&#x27; + expiresAt);
        }

        if (refreshToken) {
            this._storage.setItem(&#x27;refresh_token&#x27;, refreshToken);
        }
    }

    /**
     * Checks whether there are tokens in the hash fragment
     * as a result of the implicit flow. These tokens are
     * parsed, validated and used to sign the user in to the
     * current client.
     *
     * @param options Optinal options.
     */
    public tryLogin(options: LoginOptions &#x3D; null): Promise&lt;void&gt; {

        options &#x3D; options || { };

        let parts: object;

        if (options.customHashFragment) {
            parts &#x3D; this.urlHelper.getHashFragmentParams(options.customHashFragment);
        }
        else {
            parts &#x3D; this.urlHelper.getHashFragmentParams();
        }

        this.debug(&#x27;parsed url&#x27;, parts);

        if (parts[&#x27;error&#x27;]) {
            this.debug(&#x27;error trying to login&#x27;);
            this.handleLoginError(options, parts);
            let err &#x3D; new OAuthErrorEvent(&#x27;token_error&#x27;, {}, parts);
            this.eventsSubject.next(err);
            return Promise.reject(err);
        }

        let accessToken &#x3D; parts[&#x27;access_token&#x27;];
        let idToken &#x3D; parts[&#x27;id_token&#x27;];
        let state &#x3D; decodeURIComponent(parts[&#x27;state&#x27;]);
        let sessionState &#x3D; parts[&#x27;session_state&#x27;];

        if (!this.requestAccessToken &amp;&amp; !this.oidc) {
            return Promise.reject(&#x27;Either requestAccessToken or oidc or both must be true.&#x27;);
        }

        if (this.requestAccessToken &amp;&amp; !accessToken) return Promise.resolve();
        if (this.requestAccessToken &amp;&amp; !options.disableOAuth2StateCheck &amp;&amp; !state) return Promise.resolve();
        if (this.oidc &amp;&amp; !idToken) return Promise.resolve();

        if (this.sessionChecksEnabled &amp;&amp; !sessionState) {
            console.warn(
                &#x27;session checks (Session Status Change Notification) &#x27;
                + &#x27;is activated in the configuration but the id_token &#x27;
                + &#x27;does not contain a session_state claim&#x27;);
        }

        let stateParts &#x3D; state.split(&#x27;;&#x27;);
        if (stateParts.length &gt; 1) {
            this.state &#x3D; stateParts[1];
        }
        let nonceInState &#x3D; stateParts[0];

        if (this.requestAccessToken &amp;&amp; !options.disableOAuth2StateCheck) {
            let success &#x3D; this.validateNonceForAccessToken(accessToken, nonceInState);
            if (!success) {
                let event &#x3D; new OAuthErrorEvent(&#x27;invalid_nonce_in_state&#x27;, null);
                this.eventsSubject.next(event);
                return Promise.reject(event);
            }
        }

        if (this.requestAccessToken) {
            this.storeAccessTokenResponse(accessToken, null, parts[&#x27;expires_in&#x27;]);
        }

        if (!this.oidc) return Promise.resolve();

        return this
                .processIdToken(idToken, accessToken)
                .then(result &#x3D;&gt; {
                    if (options.validationHandler) {
                        return options.validationHandler({
                            accessToken: accessToken,
                            idClaims: result.idTokenClaims,
                            idToken: result.idToken,
                            state: state
                        }).then(_ &#x3D;&gt; result);
                    }
                    return result;
                })
                .then(result &#x3D;&gt; {
                        this.storeIdToken(result);
                        this.storeSessionState(sessionState);
                        this.eventsSubject.next(new OAuthSuccessEvent(&#x27;token_received&#x27;));
                        this.callOnTokenReceivedIfExists(options);
                        if (this.clearHashAfterLogin) location.hash &#x3D; &#x27;&#x27;;
                    })
                .catch(reason &#x3D;&gt; {
                    this.eventsSubject.next(new OAuthErrorEvent(&#x27;token_validation_error&#x27;, reason));
                    console.error(&#x27;Error validating tokens&#x27;);
                    console.error(reason);
                });

    };

    private validateNonceForAccessToken(accessToken: string, nonceInState: string): boolean {
        let savedNonce &#x3D; this._storage.getItem(&#x27;nonce&#x27;);
        if (savedNonce !&#x3D;&#x3D; nonceInState) {
            let err &#x3D; &#x27;validating access_token failed. wrong state/nonce.&#x27;;
            console.error(err, savedNonce, nonceInState);
            return false;
        }
        return true;
    }

    protected storeIdToken(idToken: ParsedIdToken) {
        this._storage.setItem(&#x27;id_token&#x27;, idToken.idToken);
        this._storage.setItem(&#x27;id_token_claims_obj&#x27;, idToken.idTokenClaimsJson);
        this._storage.setItem(&#x27;id_token_expires_at&#x27;, &#x27;&#x27; + idToken.idTokenExpiresAt);
        this._storage.setItem(&#x27;id_token_stored_at&#x27;, &#x27;&#x27; + Date.now());
    }

    protected storeSessionState(sessionState: string): void {
        this._storage.setItem(&#x27;session_state&#x27;, sessionState);
    }

    protected getSessionState(): string {
        return this._storage.getItem(&#x27;session_state&#x27;);
    }

    private handleLoginError(options: LoginOptions, parts: object): void {
        if (options.onLoginError)
            options.onLoginError(parts);
        if (this.clearHashAfterLogin) location.hash &#x3D; &#x27;&#x27;;
    }

    /**
     * @ignore
     */
    public processIdToken(idToken: string, accessToken: string): Promise&lt;ParsedIdToken&gt;  {

            let tokenParts &#x3D; idToken.split(&#x27;.&#x27;);
            let headerBase64 &#x3D; this.padBase64(tokenParts[0]);
            let headerJson &#x3D; b64DecodeUnicode(headerBase64);
            let header &#x3D; JSON.parse(headerJson);
            let claimsBase64 &#x3D; this.padBase64(tokenParts[1]);
            let claimsJson &#x3D; b64DecodeUnicode(claimsBase64);
            let claims &#x3D; JSON.parse(claimsJson);
            let savedNonce &#x3D; this._storage.getItem(&#x27;nonce&#x27;);

            if (Array.isArray(claims.aud)) {
                if (claims.aud.every(v &#x3D;&gt; v !&#x3D;&#x3D; this.clientId)) {
                    let err &#x3D; &#x27;Wrong audience: &#x27; + claims.aud.join(&#x27;,&#x27;);
                    console.warn(err);
                    return Promise.reject(err);
                }
            } else {
                if (claims.aud !&#x3D;&#x3D; this.clientId) {
                    let err &#x3D; &#x27;Wrong audience: &#x27; + claims.aud;
                    console.warn(err);
                    return Promise.reject(err);
                }
            }

            /*
            if (this.getKeyCount() &gt; 1 &amp;&amp; !header.kid) {
                let err &#x3D; &#x27;There needs to be a kid property in the id_token header when multiple keys are defined via the property jwks&#x27;;
                console.warn(err);
                return Promise.reject(err);
            }
            */

            if (!claims.sub) {
                let err &#x3D; &#x27;No sub claim in id_token&#x27;;
                console.warn(err);
                return Promise.reject(err);
            }

            /* For now, we only check whether the sub against
             * silentRefreshSubject when sessionChecksEnabled is on
             * We will reconsider in a later version to do this
             * in every other case too.
             */
            if (this.sessionChecksEnabled
                &amp;&amp; this.silentRefreshSubject
                &amp;&amp; this.silentRefreshSubject !&#x3D;&#x3D; claims[&#x27;sub&#x27;]) {

                let err &#x3D; &#x27;After refreshing, we got an id_token for another user (sub). &#x27;
                            + &#x60;Expected sub: ${this.silentRefreshSubject}, received sub: ${claims[&#x27;sub&#x27;]}&#x60;;

                console.warn(err);
                return Promise.reject(err);
            }

            if (!claims.iat) {
                let err &#x3D; &#x27;No iat claim in id_token&#x27;;
                console.warn(err);
                return Promise.reject(err);
            }

            if (claims.iss !&#x3D;&#x3D; this.issuer) {
                let err &#x3D; &#x27;Wrong issuer: &#x27; + claims.iss;
                console.warn(err);
                return Promise.reject(err);
            }

            if (claims.nonce !&#x3D;&#x3D; savedNonce) {
                let err &#x3D; &#x27;Wrong nonce: &#x27; + claims.nonce;
                console.warn(err);
                return Promise.reject(err);
            }

            if (!this.disableAtHashCheck &amp;&amp; this.requestAccessToken &amp;&amp; !claims[&#x27;at_hash&#x27;]) {
                let err &#x3D; &#x27;An at_hash is needed!&#x27;;
                console.warn(err);
                return Promise.reject(err);
            }

            let now &#x3D; Date.now();
            let issuedAtMSec &#x3D; claims.iat * 1000;
            let expiresAtMSec &#x3D; claims.exp * 1000;
            let tenMinutesInMsec &#x3D; 1000 * 60 * 10;

            if (issuedAtMSec - tenMinutesInMsec &gt;&#x3D; now  || expiresAtMSec + tenMinutesInMsec &lt;&#x3D; now) {
                let err &#x3D; &#x27;Token has been expired&#x27;;
                console.error(err);
                console.error({
                    now: now,
                    issuedAtMSec: issuedAtMSec,
                    expiresAtMSec: expiresAtMSec
                });
                return Promise.reject(err);
            }

            let validationParams: ValidationParams &#x3D; {
                accessToken: accessToken,
                idToken: idToken,
                jwks: this.jwks,
                idTokenClaims: claims,
                idTokenHeader: header,
                loadKeys: () &#x3D;&gt; this.loadJwks()
            };

            if (!this.disableAtHashCheck &amp;&amp; this.requestAccessToken &amp;&amp; !this.checkAtHash(validationParams)) {
                let err &#x3D; &#x27;Wrong at_hash&#x27;;
                console.warn(err);
                return Promise.reject(err);
            }

            return this.checkSignature(validationParams).then(_ &#x3D;&gt; {
                let result: ParsedIdToken &#x3D; {
                    idToken: idToken,
                    idTokenClaims: claims,
                    idTokenClaimsJson: claimsJson,
                    idTokenHeader: header,
                    idTokenHeaderJson: headerJson,
                    idTokenExpiresAt: expiresAtMSec,
                };
                return result;
            });

    }

    /**
     * Returns the received claims about the user.
     */
    public getIdentityClaims(): object {
        let claims &#x3D; this._storage.getItem(&#x27;id_token_claims_obj&#x27;);
        if (!claims) return null;
        return JSON.parse(claims);
    }

    /**
     * Returns the current id_token.
     */
    public getIdToken(): string {
        return this._storage.getItem(&#x27;id_token&#x27;);
    }

    private padBase64(base64data): string {
        while (base64data.length % 4 !&#x3D;&#x3D; 0) {
            base64data +&#x3D; &#x27;&#x3D;&#x27;;
        }
        return base64data;
    }

    /**
     * Returns the current access_token.
     */
    public getAccessToken(): string {
        return this._storage.getItem(&#x27;access_token&#x27;);
    };

    /**
     * Returns the expiration date of the access_token
     * as milliseconds since 1970.
     */
    public getAccessTokenExpiration(): number {
        if (!this._storage.getItem(&#x27;expires_at&#x27;)) return null;
        return parseInt(this._storage.getItem(&#x27;expires_at&#x27;), 10);
    }


    private getAccessTokenStoredAt(): number {
        return parseInt(this._storage.getItem(&#x27;access_token_stored_at&#x27;), 10);
    }

    private getIdTokenStoredAt(): number {
        return parseInt(this._storage.getItem(&#x27;id_token_stored_at&#x27;), 10);
    }

    /**
     * Returns the expiration date of the id_token
     * as milliseconds since 1970.
     */
    public getIdTokenExpiration(): number {

        if (!this._storage.getItem(&#x27;id_token_expires_at&#x27;)) return null;

        return parseInt(this._storage.getItem(&#x27;id_token_expires_at&#x27;), 10);
    }

    /**
     * Checkes, whether there is a valid access_token.
    */
    public hasValidAccessToken(): boolean {
        if (this.getAccessToken()) {

            let expiresAt &#x3D; this._storage.getItem(&#x27;expires_at&#x27;);
            let now &#x3D; new Date();
            if (expiresAt &amp;&amp; parseInt(expiresAt, 10) &lt; now.getTime()) {
                return false;
            }

            return true;
        }

        return false;
    };

    /**
     * Checkes, whether there is a valid id_token.
    */
    public hasValidIdToken(): boolean {
        if (this.getIdToken()) {

            let expiresAt &#x3D; this._storage.getItem(&#x27;id_token_expires_at&#x27;);
            let now &#x3D; new Date();
            if (expiresAt &amp;&amp; parseInt(expiresAt, 10) &lt; now.getTime()) {
                return false;
            }

            return true;
        }

        return false;
    };

    /**
     * Returns the auth-header that can be used
     * to transmit the access_token to a service
    */
    public authorizationHeader(): string {
        return &#x27;Bearer &#x27; + this.getAccessToken();
    }

    /**
     * Removes all tokens and logs the user out.
     * If a logout url is configured, the user is
     * redirected to it.
     * @param noRedirectToLogoutUrl
     */
    public logOut(noRedirectToLogoutUrl &#x3D; false): void {
        let id_token &#x3D; this.getIdToken();
        this._storage.removeItem(&#x27;access_token&#x27;);
        this._storage.removeItem(&#x27;id_token&#x27;);
        this._storage.removeItem(&#x27;refresh_token&#x27;);
        this._storage.removeItem(&#x27;nonce&#x27;);
        this._storage.removeItem(&#x27;expires_at&#x27;);
        this._storage.removeItem(&#x27;id_token_claims_obj&#x27;);
        this._storage.removeItem(&#x27;id_token_expires_at&#x27;);
        this._storage.removeItem(&#x27;id_token_stored_at&#x27;);
        this._storage.removeItem(&#x27;access_token_stored_at&#x27;);
        
        this.silentRefreshSubject &#x3D; null;

        if (!this.logoutUrl) return;
        if (noRedirectToLogoutUrl) return;
        if (!id_token) return;

        let logoutUrl: string;

        if (!this.validateUrlForHttps(this.logoutUrl)) throw new Error(&#x27;logoutUrl must use Http. Also check property requireHttps.&#x27;);
        
        // For backward compatibility
        if (this.logoutUrl.indexOf(&#x27;{{&#x27;) &gt; -1) {
            logoutUrl &#x3D; this.logoutUrl.replace(/\{\{id_token\}\}/, id_token);
        }
        else {
            logoutUrl &#x3D; this.logoutUrl + &#x27;?id_token_hint&#x3D;&#x27;
                                + encodeURIComponent(id_token)
                                + &#x27;&amp;post_logout_redirect_uri&#x3D;&#x27;
                                + encodeURIComponent(this.postLogoutRedirectUri || this.redirectUri);
        }
        location.href &#x3D; logoutUrl;
    };

    /**
     * @ignore
     */
    public createAndSaveNonce(): Promise&lt;string&gt; {
        let that &#x3D; this;
        return this.createNonce().then(function (nonce: any) {
            that._storage.setItem(&#x27;nonce&#x27;, nonce);
            return nonce;
        });
    };

    protected createNonce(): Promise&lt;string&gt; {

        return new Promise((resolve, reject) &#x3D;&gt; {

            if (this.rngUrl) {
                throw new Error(&#x27;createNonce with rng-web-api has not been implemented so far&#x27;);
            }
            else {
                let text &#x3D; &#x27;&#x27;;
                let possible &#x3D; &#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;;

                for (let i &#x3D; 0; i &lt; 40; i++)
                    text +&#x3D; possible.charAt(Math.floor(Math.random() * possible.length));

                resolve(text);
            }

        });
    };

    private checkAtHash(params: ValidationParams): boolean {

        if (!this.tokenValidationHandler) {
            console.warn(&#x27;No tokenValidationHandler configured. Cannot check at_hash.&#x27;);
            return true;
        }
        return this.tokenValidationHandler.validateAtHash(params);
    }

    private checkSignature(params: ValidationParams): Promise&lt;any&gt; {
        if (!this.tokenValidationHandler) {
            console.warn(&#x27;No tokenValidationHandler configured. Cannot check signature.&#x27;);
            return Promise.resolve(null);
        }
        return this.tokenValidationHandler.validateSignature(params);
    }

}
</code></pre>
    </div>
</div>







                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
           </div>
       </div>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script>var COMPODOC_CURRENT_PAGE_DEPTH = 1;</script>

       <script src="../js/search/search.js"></script>
       <script src="../js/search/lunr.min.js"></script>
       <script src="../js/search/search-lunr.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
       <script src="../js/search/search_index.js"></script>

    </body>
</html>
